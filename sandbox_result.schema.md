# sandbox_result.schema.md

---

## Status

FINAL for v1  
MANDATORY  
HOST-VERIFIED  
NON-NEGOTIABLE  

This document defines the **Sandbox Result & Diff Schema**, the canonical representation of **what actually happened** when an Action Descriptor was executed inside a sandbox.

No action may be promoted, committed, rolled back, or audited unless it produces a valid Sandbox Result that conforms to this schema.

---

## 0. Purpose

The Sandbox Result exists to answer a single question:

Did the sandboxed execution behave exactly as declared, and nothing more?

It serves as the **ground truth** used by the host to decide whether to promote once, require confirmation, block permanently, or trigger rollback.

The AI does not control, edit, reinterpret, or regenerate this result.

---

## 1. Core Principles

Every Sandbox Result must satisfy the following principles:

Completeness — all observable effects are reported.  
Determinism — identical inputs produce comparable results.  
Boundedness — all resource usage is measured.  
Declarative comparison — results are compared strictly against the Action Descriptor.  
Host authority — results are generated and verified exclusively by host tooling.

Violation of any principle results in an automatic block.

---

## 2. Sandbox Result Lifecycle

The lifecycle of a Sandbox Result is strictly linear:

1. The host launches the sandbox with the Action Descriptor.  
2. The sandbox executes the action at most once.  
3. The sandbox is terminated.  
4. The host collects outputs, filesystem diffs, and resource metrics.  
5. The host validates the Sandbox Result schema.  
6. The host compares the result against the Action Descriptor.  
7. The host decides the next step.

The AI never modifies, retries, or influences sandbox execution.

---

## 3. Top-Level Structure

A Sandbox Result consists of the following top-level sections:

Metadata identifying the schema, action, and sandbox execution.  
Execution summary describing how the sandbox terminated.  
Program outputs for informational purposes.  
Filesystem diffs representing all file-level effects.  
Resource usage metrics measured by the host.  
Side effects observed during execution.  
Compliance evaluation generated by the host.  
Verdict information to support policy decisions.  
Audit metadata for logging and retention.

All sections are mandatory unless explicitly stated otherwise.

---

## 4. Metadata

### 4.1 Schema Version

The schema version identifies the Sandbox Result format version.

It is a string value, for example: 1.0.

### 4.2 Action ID

The action ID uniquely identifies the Action Descriptor.

It must exactly match the action_id declared in the Action Descriptor.

Any mismatch invalidates the Sandbox Result.

### 4.3 Sandbox ID

The sandbox ID uniquely identifies a single sandbox execution.

It is used for forensic traceability and audit correlation.

---

## 5. Execution Summary

### 5.1 Execution

The execution summary records when the sandbox started, when it ended, how it terminated, and its final status.

Possible execution statuses are:

SUCCESS  
FAILURE  
TIMEOUT  
RESOURCE_KILLED  
POLICY_ABORTED  
SANDBOX_ERROR  

A non-SUCCESS status does not imply unsafe behavior.

Promotion decisions depend on compliance, not execution success.

---

## 6. Program Outputs

### 6.1 Outputs

Program outputs include standard output and standard error streams.

Outputs are informational only and are never used to justify promotion.

Truncation limits are host-defined, and truncation must be explicitly indicated.

---

## 7. Filesystem Diff (CRITICAL)

### 7.1 Diff

The filesystem diff represents all file-level changes caused by sandbox execution.

Changes are categorized as added files, modified files, and deleted files.

All paths must be absolute.

No filesystem changes are permitted outside the declared scope.

Deleted files must be tombstoned rather than physically destroyed.

Cryptographic hashes are mandatory for all file changes.

Any undeclared filesystem effect results in a hard block.

---

## 8. Resource Usage Report

### 8.1 Resources

Resource usage metrics include CPU time, memory usage, disk I/O, network I/O, and wall-clock time.

All values are measured by the host.

Exceeding declared resource limits results in non-compliance.

Any network usage when not explicitly declared results in a hard block.

---

## 9. Side Effects Declaration

### 9.1 Side Effects

Side effects describe observable behaviors beyond filesystem and output changes.

These include network usage, spawned processes, sent signals, privileged system calls, and device access.

Privileged system calls must always be false.

Device access must always be false.

Any side effects beyond what was declared result in a block.

---

## 10. Compliance Evaluation (HOST-GENERATED)

### 10.1 Compliance

Compliance evaluation is generated exclusively by the host.

It determines whether observed behavior matches declared effects, remains within resource limits, stays within scope, meets sandbox requirements, and supports rollback.

All compliance fields must be true for promotion eligibility.

Any false value forbids promotion.

---

## 11. Verdict (HOST DECISION SUPPORT)

### 11.1 Verdict

The verdict provides structured guidance to the host policy engine.

Possible recommended actions are:

PROMOTE  
REQUIRE_CONFIRMATION  
BLOCK  
FORCE_ROLLBACK  

The final decision always remains with the host policy engine.

---

## 12. Audit Metadata

### 12.1 Audit

Audit metadata controls logging, log level, retention duration, and forensic references.

The AI cannot access forensic logs.

Retention policy is entirely host-controlled.

---

## 13. Hard Failure Conditions (Immediate Block)

A Sandbox Result is invalid if any of the following occur:

Action ID mismatch.  
Undeclared filesystem effects.  
Undeclared network usage.  
Resource limits exceeded.  
Sandbox errors occurred.  
Filesystem diff cannot be verified.  
Compliance fields are missing.

Invalid results must never be promoted.

---

## 14. Relationship to Rollback

Sandbox execution itself never requires rollback.

Sandbox Results define the rollback scope if an action is promoted.

Rollback scope must exactly match both declared and observed effects.

---

## 15. Final Rule (Absolute)

Reality is defined solely by what the Sandbox Result reports, not by AI intent.

If intent and result disagree, the result always wins.

END OF DOCUMENT

---

## What This Completes

You now have:

An Action Descriptor Schema defining what is allowed.  
A Sandbox Result & Diff Schema defining what actually happened.

Together, they form the **execution contract**.